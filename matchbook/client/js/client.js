
window.addEventListener('load', function() {

	const g_sportsWiseBetList = 
									{
										"Horse Racing": [
											{
												"status": "matched",
												"sport-id": 24735152712200,
												"sport-name": "Horse Racing",
												"event-id": 1956830763120016,
												"event-name": "12:45 Ludlow",
												"runner-name": "5 Dr T J Eckleburg",
												"decimal-odds": 1.8,
												"stake": 0.2,
												"event-full-details": {
													"id": 1956830763120016,
													"start": "2022-01-10T12:45:00.000Z",
													"allRunners": {
														"5 Dr T J Eckleburg": {
															"runnerId": 1956830764010016,
															"back": 1.76,
															"lay": 1.95,
															"name": "5 Dr T J Eckleburg",
															"event-name": "12:45 Ludlow",
															"numberOfRunners": 10,
															"winPercentage": 150.00000000000003,
															"startTime": "2022-01-10T12:45:00.000Z",
															"raceId": 1956830763120016,
															"raceName": "12:45 Ludlow",
															"sportName": "Horse Racing"
														},
														"1 Illico Des Places": {
															"runnerId": 1956830763880016,
															"back": 4.4,
															"lay": 6.2,
															"name": "1 Illico Des Places",
															"event-name": "12:45 Ludlow"
														},
														"7 Imperial Sun": {
															"runnerId": 1956830764070016,
															"back": 6.6,
															"lay": 8.8,
															"name": "7 Imperial Sun",
															"event-name": "12:45 Ludlow"
														},
														"10 Angels Landing": {
															"runnerId": 1956830764170116,
															"back": 7,
															"lay": 14,
															"name": "10 Angels Landing",
															"event-name": "12:45 Ludlow"
														},
														"2 Appreciate": {
															"runnerId": 1956830763920016,
															"back": 21,
															"lay": 0,
															"name": "2 Appreciate",
															"event-name": "12:45 Ludlow"
														},
														"3 Bryanwood": {
															"runnerId": 1956830763950016,
															"back": 21,
															"lay": 0,
															"name": "3 Bryanwood",
															"event-name": "12:45 Ludlow"
														},
														"4 Dragon's Fire": {
															"runnerId": 1956830763980016,
															"back": 6,
															"lay": 0,
															"name": "4 Dragon's Fire",
															"event-name": "12:45 Ludlow"
														},
														"6 Fight For It": {
															"runnerId": 1956830764040016,
															"back": 16,
															"lay": 0,
															"name": "6 Fight For It",
															"event-name": "12:45 Ludlow"
														},
														"8 Kolisi": {
															"runnerId": 1956830764100116,
															"back": 14.5,
															"lay": 0,
															"name": "8 Kolisi",
															"event-name": "12:45 Ludlow"
														},
														"9 Mind Hunter": {
															"runnerId": 1956830764140116,
															"back": 26,
															"lay": 990,
															"name": "9 Mind Hunter",
															"event-name": "12:45 Ludlow"
														}
													},
													"metaData": {
														"stakeValue": 0.2,
														"todayTotalBetAmountLimit": 3,
														"sumOfAlreadyPlacedBetAmount": 0,
														"userBalance": 10.35,
														"winConfidencePercentage": 80,
														"minProfitOdd": 0.7
													},
													"luckyWinner": {
														"runnerId": 1956830764010016,
														"back": 1.76,
														"lay": 1.95,
														"name": "5 Dr T J Eckleburg",
														"event-name": "12:45 Ludlow",
														"numberOfRunners": 10,
														"winPercentage": 150.00000000000003,
														"startTime": "2022-01-10T12:45:00.000Z",
														"raceId": 1956830763120016,
														"raceName": "12:45 Ludlow",
														"sportName": "Horse Racing"
													}
												},
												"metaData": {
													"stakeValue": 0.2,
													"todayTotalBetAmountLimit": 3,
													"sumOfAlreadyPlacedBetAmount": 0,
													"userBalance": 10.35,
													"winConfidencePercentage": 80,
													"minProfitOdd": 0.7
												},
												"event-start-time": "10/01/2022, 12:45:00",
												"bet-placed-time": "07:50:54  10-01-2022"
											},
											{
												"status": "matched",
												"sport-id": 24735152712200,
												"sport-name": "Horse Racing",
												"event-id": 1956831980740016,
												"event-name": "13:30 Taunton",
												"runner-name": "6 Knickerbockerglory",
												"decimal-odds": 2.4,
												"stake": 0.2,
												"event-full-details": {
													"id": 1956831980740016,
													"start": "2022-01-10T13:30:00.000Z",
													"allRunners": {
														"6 Knickerbockerglory": {
															"runnerId": 1956831981840116,
															"back": 2.36,
															"lay": 2.6,
															"name": "6 Knickerbockerglory",
															"event-name": "13:30 Taunton",
															"numberOfRunners": 14,
															"winPercentage": 82.20338983050848,
															"startTime": "2022-01-10T13:30:00.000Z",
															"raceId": 1956831980740016,
															"raceName": "13:30 Taunton",
															"sportName": "Horse Racing"
														},
														"12 Sword Beach": {
															"runnerId": 1956831982010016,
															"back": 6.6,
															"lay": 34,
															"name": "12 Sword Beach",
															"event-name": "13:30 Taunton"
														},
														"1 Ben Lilly": {
															"runnerId": 1956831981700016,
															"back": 11,
															"lay": 0,
															"name": "1 Ben Lilly",
															"event-name": "13:30 Taunton"
														},
														"2 Charming Getaway": {
															"runnerId": 1956831981730116,
															"back": 10.5,
															"lay": 0,
															"name": "2 Charming Getaway",
															"event-name": "13:30 Taunton"
														},
														"4 Hartnoll Hero": {
															"runnerId": 1956831981790016,
															"back": 16,
															"lay": 0,
															"name": "4 Hartnoll Hero",
															"event-name": "13:30 Taunton"
														},
														"5 Jump Over The Moon": {
															"runnerId": 1956831981810116,
															"back": 10,
															"lay": 0,
															"name": "5 Jump Over The Moon",
															"event-name": "13:30 Taunton"
														},
														"7 Marettimo": {
															"runnerId": 1956831981870116,
															"back": 19.5,
															"lay": 0,
															"name": "7 Marettimo",
															"event-name": "13:30 Taunton"
														},
														"8 Moveit Like Minnie": {
															"runnerId": 1956831981900016,
															"back": 5.1,
															"lay": 17,
															"name": "8 Moveit Like Minnie",
															"event-name": "13:30 Taunton"
														},
														"9 Muy Bien": {
															"runnerId": 1956831981920116,
															"back": 15,
															"lay": 0,
															"name": "9 Muy Bien",
															"event-name": "13:30 Taunton"
														},
														"10 Quickbuck": {
															"runnerId": 1956831981950016,
															"back": 4.3,
															"lay": 0,
															"name": "10 Quickbuck",
															"event-name": "13:30 Taunton"
														},
														"11 Rocambolas": {
															"runnerId": 1956831981980016,
															"back": 10,
															"lay": 0,
															"name": "11 Rocambolas",
															"event-name": "13:30 Taunton"
														},
														"13 Chillabella": {
															"runnerId": 1956831982030116,
															"back": 6,
															"lay": 990,
															"name": "13 Chillabella",
															"event-name": "13:30 Taunton"
														},
														"14 Chadlington Lad": {
															"runnerId": 1956831982070016,
															"back": 19,
															"lay": 0,
															"name": "14 Chadlington Lad",
															"event-name": "13:30 Taunton"
														},
														"3 Forward Plan": {
															"runnerId": 1956831981760116,
															"back": 0,
															"lay": 0,
															"name": "3 Forward Plan",
															"event-name": "13:30 Taunton"
														}
													},
													"metaData": {
														"stakeValue": 0.2,
														"todayTotalBetAmountLimit": 3,
														"sumOfAlreadyPlacedBetAmount": 0,
														"userBalance": 10.35,
														"winConfidencePercentage": 80,
														"minProfitOdd": 0.7
													},
													"luckyWinner": {
														"runnerId": 1956831981840116,
														"back": 2.36,
														"lay": 2.6,
														"name": "6 Knickerbockerglory",
														"event-name": "13:30 Taunton",
														"numberOfRunners": 14,
														"winPercentage": 82.20338983050848,
														"startTime": "2022-01-10T13:30:00.000Z",
														"raceId": 1956831980740016,
														"raceName": "13:30 Taunton",
														"sportName": "Horse Racing"
													}
												},
												"metaData": {
													"stakeValue": 0.2,
													"todayTotalBetAmountLimit": 3,
													"sumOfAlreadyPlacedBetAmount": 0,
													"userBalance": 10.35,
													"winConfidencePercentage": 80,
													"minProfitOdd": 0.7
												},
												"event-start-time": "10/01/2022, 13:30:00",
												"bet-placed-time": "07:52:44  10-01-2022"
											}
										],
										"Soccer": [
											{
												"status": "matched",
												"sport-id": 15,
												"sport-name": "Soccer",
												"event-id": 1955588068000016,
												"event-name": "Jong FC Utrecht vs Jong Ajax",
												"runner-name": "Jong Ajax",
												"decimal-odds": 1.8,
												"stake": 0.2,
												"event-full-details": {
													"id": 1955588068000016,
													"start": "2022-01-10T17:45:00.000Z",
													"allRunners": {
														"Jong FC Utrecht": {
															"runnerId": 1955588069240016,
															"back": 4.6,
															"lay": 4.9,
															"name": "Jong FC Utrecht",
															"event-name": "Jong FC Utrecht vs Jong Ajax"
														},
														"Jong Ajax": {
															"runnerId": 1955588069280016,
															"back": 1.72,
															"lay": 1.78,
															"name": "Jong Ajax",
															"event-name": "Jong FC Utrecht vs Jong Ajax",
															"numberOfRunners": 3,
															"winPercentage": 155.81395348837214,
															"startTime": "2022-01-10T17:45:00.000Z",
															"raceId": 1955588068000016,
															"raceName": "Jong FC Utrecht vs Jong Ajax",
															"sportName": "Soccer"
														},
														"DRAW (Jon/Jon)": {
															"runnerId": 1955588069310016,
															"back": 4.4,
															"lay": 4.7,
															"name": "DRAW (Jon/Jon)",
															"event-name": "Jong FC Utrecht vs Jong Ajax"
														}
													},
													"metaData": {
														"stakeValue": 0.2,
														"todayTotalBetAmountLimit": 3,
														"sumOfAlreadyPlacedBetAmount": 0,
														"userBalance": 10.35,
														"winConfidencePercentage": 80,
														"minProfitOdd": 0.7
													},
													"luckyWinner": {
														"runnerId": 1955588069280016,
														"back": 1.72,
														"lay": 1.78,
														"name": "Jong Ajax",
														"event-name": "Jong FC Utrecht vs Jong Ajax",
														"numberOfRunners": 3,
														"winPercentage": 155.81395348837214,
														"startTime": "2022-01-10T17:45:00.000Z",
														"raceId": 1955588068000016,
														"raceName": "Jong FC Utrecht vs Jong Ajax",
														"sportName": "Soccer"
													}
												},
												"metaData": {
													"stakeValue": 0.2,
													"todayTotalBetAmountLimit": 3,
													"sumOfAlreadyPlacedBetAmount": 0,
													"userBalance": 10.35,
													"winConfidencePercentage": 80,
													"minProfitOdd": 0.7
												},
												"event-start-time": "10/01/2022, 17:45:00",
												"bet-placed-time": "07:50:59  10-01-2022"
											}
										]
									};


	let g_runnersStr  = "";
	let g_logMessages = "";
	let g_logMessagesBuffer = ""; 
	const g_logMessageMaxBufferLength = 4000; // string length <= 10,000 

	// enum - constants
	const g_SYMBOL_CONSTANTS = Object.freeze({
		"ALL_PREDICTION_LIST"     :  "ALL_PREDICTION_LIST",
		"CURRENT_PREDICTION_LIST" :  "CURRENT_PREDICTION_LIST",
		"PLACED_BET_LIST"         :  "PLACED_BET_LIST",
		"LOG_MESSAGES"            :  "LOG_MESSAGES"
	});

	printRunner = function(runnerName, odd, cssClass) {
		cssClass = cssClass || '';
		g_runnersStr += `<div class="gridColumnLayout gridColumnLayout_2">
					<!-- Runner Name -->
					<div class="commonClass colOne  ${cssClass}"> ${runnerName} </div>
					<!-- Stake -->
					<div class="commonClass colTwo  ${cssClass}"> ${odd} </div>
					</div>`;
	};

	fillMainHTMLContent = function(statsMsg, content) {
		document.querySelector('#statistics').innerHTML = statsMsg;
		document.querySelector('#predictionList').innerHTML = content;
	};

	showLogMessages = function() {
		const htmlContent = `<div class="sportsName"><div class ="commonClass"><b>${g_logMessages}</b></div></div>`;
		fillMainHTMLContent("", htmlContent);
	};

	renderLogMessages = function(msg) {
		g_logMessages       += msg + "<br/>";
		g_logMessagesBuffer += msg + "<br/>";
		if(g_logMessagesBuffer.length > g_logMessageMaxBufferLength)
		{
			g_logMessages = g_logMessagesBuffer;
			g_logMessagesBuffer = "";
		}
	};

	clearLogMessages = () => { 
		g_logMessages = "";
		g_logMessagesBuffer = "";
		fillMainHTMLContent("", "");
	};

	createPredictedWinnersTable = function(predictedWinnerList) {
		let eventCounter = 0;
		g_runnersStr = "";
		let metaData = "";
		let statsMsg = "";

		for (let sport in predictedWinnerList) {
			if (predictedWinnerList.hasOwnProperty(sport)) {
				// Sport Name
				g_runnersStr +=  `  <br/>
									<div class="sportsName">
									<!-- Sports Name(Horse Racing) -->
									<div class ="commonClass"><b>${sport.toUpperCase()}</b></div>
									</div>`;

				for(let eventNo = 0, n = predictedWinnerList[sport].length; eventNo < n; ++eventNo) {
					// Event Name
					const eventName = predictedWinnerList[sport][eventNo]['event-name'];
					const eventFullDetails = predictedWinnerList[sport][eventNo]['event-full-details'];
					metaData = predictedWinnerList[sport][eventNo]['metaData'];

					g_runnersStr += ` <br/>
								<div class="eventName">
									<!-- Event Name(3.30 Kempton) -->
									<div class ="commonClass">(${++eventCounter})   ${eventName}   (${sport.toUpperCase()})     ${predictedWinnerList[sport][eventNo]['event-start-time']} </div>
								
									Today's Bet Amount Limit =  £ ${metaData.sumOfAlreadyPlacedBetAmount} / £ ${metaData.todayTotalBetAmountLimit}, 
									UserBalance = £ ${metaData.currentBalance}, 
									WinConfidencePercentage = ${metaData.minWinConfidencePercentage}%, 
									MinProfitOdd = £ ${metaData.minProfitOdd}, 
									Stake = £ ${metaData.stakeValue}
								</div>
								<br/>`;

					printRunner(predictedWinnerList[sport][eventNo]['runner-name'], predictedWinnerList[sport][eventNo]['decimal-odds'], 'cssWinnerClass');

					for (let runner in eventFullDetails.allRunners) {
						// Players List
						if (eventFullDetails.allRunners.hasOwnProperty(runner)) {
							if(predictedWinnerList[sport][eventNo]['runner-name'] != eventFullDetails.allRunners[runner].name)
								printRunner(eventFullDetails.allRunners[runner].name, eventFullDetails.allRunners[runner].back);
						}
					}

					g_runnersStr += `<br/>`;
				}
			}
		}

		statsMsg = `# Total Number of Predictions = ${eventCounter}`;
		fillMainHTMLContent(statsMsg, g_runnersStr);
	};

	// createPredictedWinnersTable(g_sportsWiseBetList); // test

	/////////////////////////// Button Events //////////////////////////////////
	let g_activePageName = g_SYMBOL_CONSTANTS.ALL_PREDICTION_LIST;
	const g_pageNameDisplayArea = document.querySelector('#pageNameDisplayAreaId');
	g_pageNameDisplayArea.innerHTML = `<b>:: Predictions List ::</b>`;

	// button id and addEventListeners mapping
	document.querySelector('#allPredictionBtnId').addEventListener('click', showResults);
	document.querySelector('#currentPredictionBtnId').addEventListener('click', showResults);
	document.querySelector('#placedBetBtnId').addEventListener('click', showResults);
	document.querySelector('#logMessagesBtnId').addEventListener('click', showResults);

	document.querySelector('#clearLogMessagesBtnId').addEventListener('click', clearLogMessages);

	/////////////////////////////////// SOCKET.IO (start) //////////////////////////////////////////////////////////////

	const socket = io(); // NOTE: you MUST run by http://localhost:3000/index.html

	// [Client <= Server] Receive data from server to client
	socket.on('SERVER_TO_CLIENT_ALL_PREDICTED_WINNERS_EVENT',     async (data) => { populateClientPage(data, g_SYMBOL_CONSTANTS.ALL_PREDICTION_LIST); });
	socket.on('SERVER_TO_CLIENT_CURRENT_PREDICTED_WINNERS_EVENT', async (data) => { populateClientPage(data, g_SYMBOL_CONSTANTS.CURRENT_PREDICTION_LIST); });
	socket.on('SERVER_TO_CLIENT_ALREADY_PLACED_BETS_EVENT',       async (data) => { populateClientPage(data, g_SYMBOL_CONSTANTS.PLACED_BET_LIST); });
	socket.on('SERVER_TO_CLIENT_LOG_MESSAGES_EVENT',              async (data) => { renderLogMessages(data); populateClientPage(data, g_SYMBOL_CONSTANTS.LOG_MESSAGES);});

	// [Client => Server] Send the data from client to server 
	function notifyToServer(event, data) {
		socket.emit(event, data);
	}

	notifyToServer('CLIENT_TO_SERVER_GIVE_ALL_PREDICTION_EVENT', JSON.stringify({ msg:"give all prediction list"}));

	/////////////////////////////////// SOCKET.IO (end) //////////////////////////////////////////////////////////////

	function showResults(e) {
		switch(this.dataset.key)  // e.currentTarget.dataset.key
		{
			case g_SYMBOL_CONSTANTS.ALL_PREDICTION_LIST:
				g_activePageName = this.dataset.key;
				g_pageNameDisplayArea.innerHTML = `<b>:: All Predictions List ::</b>`;
				notifyToServer('CLIENT_TO_SERVER_GIVE_ALL_PREDICTION_EVENT', JSON.stringify({  msg:"give all prediction list"}));
				break;

			case g_SYMBOL_CONSTANTS.CURRENT_PREDICTION_LIST:
				g_activePageName = this.dataset.key;
				g_pageNameDisplayArea.innerHTML = `<b>:: Current Prediction List ::</b>`;
				notifyToServer('CLIENT_TO_SERVER_GIVE_CURRENT_PREDICTION_EVENT', JSON.stringify({ msg:'give current prediction list'}));
				break;

			case g_SYMBOL_CONSTANTS.PLACED_BET_LIST:
				g_activePageName = this.dataset.key;
				g_pageNameDisplayArea.innerHTML = `<b>:: Bet Placed List ::</b>`;
				notifyToServer('CLIENT_TO_SERVER_GIVE_ALREADY_PLACED_BETS_EVENT', JSON.stringify({ msg:"give already placed bet list" }));
				break;

			case g_SYMBOL_CONSTANTS.LOG_MESSAGES:
				g_activePageName = this.dataset.key;
				g_pageNameDisplayArea.innerHTML = `<b>:: Log Messages ::</b>`;
				showLogMessages();
				notifyToServer('CLIENT_TO_SERVER_GIVE_LOG_MESSAGES_EVENT', JSON.stringify({ msg:'give log messages'}));
				break;
		}
		// console.log(e.key);       // d
		// console.log(this.value);  // srid
	}
	////////////////////////////////////////////////////////////////////////////

	populateClientPage = (data, dataType) => {

		if(g_activePageName === dataType) 
		{
			if(g_activePageName === g_SYMBOL_CONSTANTS.LOG_MESSAGES) {
				showLogMessages();
			}
			else {
				const result = JSON.parse(data);
				console.log(result);
				createPredictedWinnersTable(result);
			}
		}
	};

	////////////////////////////////////////////////////////////////////////////
	const sportsWinningConstants = {
		"allSports": {
			"g_BetStakeValue"           : 0.2,  // ( 0.1 = 1p, 1 = £1) your REAL MONEY !!!!
			"g_betMinutesOffset"        : 600,  // (600 = 10hrs before). 1 => place bet: +1 min before the start time, -5 min after the start time	
			"g_minWinConfidencePercentage" : 80,   // 80 => comparison with nearest competitor ex: 100  (100% or more)
			"g_minProfitOdd"            : 0.8,  // 0.7 => £0.7,  ex: 1 => £1 (1/1 = 1 even odd [or] 2.00 in decimal)
		},

		"Horse Racing": {
			"autoBetAtBestWinningTime"  : true, // ignore "g_betMinutesOffset"
			// "g_betMinutesOffset"     : 3,    // place bet: +1 min before the start time, -5 min after the start time
			"g_minWinConfidencePercentage" : 80,   // ex: 80 => (80% or more)
			"g_minProfitOdd"            : 0.7   // 0.7 => £0.7,  ex: 1 => £1 (1/1 = 1 even odd [or] 2.00 in decimal)
		},

		"Tennis": {
			// "betAfterEventStarted": true, // "in-running-flag"
			// g_betMinutesOffset = -1; // place bet: +1 min before the start time, -5 min after the start time
			"g_betMinutesOffset": 3,         // g_betMinutesOffset

			"g_minWinConfidencePercentage": 80, // ex: 80 => (80% or more)

			"g_minProfitOdd": 0.7 // 0.7 => £0.7,  ex: 1 => £1 (1/1 = 1 even odd [or] 2.00 in decimal)
		},


	};


	test = () => {
		const sportsName = "Horse Racing";
		let mergedWinningConsts = sportsWinningConstants["allSports"];
			if(sportsWinningConstants[sportsName])
			{
				mergedWinningConsts = { ...sportsWinningConstants["allSports"], ...sportsWinningConstants[sportsName] }
			}

			console.log(mergedWinningConsts);
		

	};
	// test();



}); // window.addEventListener('load', function() {
