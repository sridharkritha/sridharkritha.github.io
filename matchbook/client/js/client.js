
window.addEventListener('load', function() {


	const g_sportsWiseBetList = 
	{
		"Soccer": [
		  {
			"status": "matched",
			"sport-id": 15,
			"sport-name": "Soccer",
			"event-id": 1949402913700016,
			"event-name": "FC Cartagena vs Valencia",
			"runner-name": "Valencia",
			"decimal-odds": 1.9,
			"stake": 0.2,
			"event-full-details": {
			  "id": 1949402913700016,
			  "start": "2022-01-05T15:00:00.000Z",
			  "allRunners": {
				"FC Cartagena": {
				  "runnerId": 1949402917630016,
				  "back": 5,
				  "lay": 5.4,
				  "name": "FC Cartagena"
				},
				"Valencia": {
				  "runnerId": 1949402917660116,
				  "back": 1.82,
				  "lay": 1.89,
				  "name": "Valencia",
				  "numberOfRunners": 3,
				  "winPercentage": 97.8021978021978,
				  "startTime": "2022-01-05T15:00:00.000Z",
				  "raceId": 1949402913700016,
				  "raceName": "FC Cartagena vs Valencia",
				  "sportName": "Soccer"
				},
				"DRAW (FC /Val)": {
				  "runnerId": 1949402917700016,
				  "back": 3.6,
				  "lay": 3.8,
				  "name": "DRAW (FC /Val)"
				}
			  },
			  "luckyWinner": {
				"runnerId": 1949402917660116,
				"back": 1.82,
				"lay": 1.89,
				"name": "Valencia",
				"numberOfRunners": 3,
				"winPercentage": 97.8021978021978,
				"startTime": "2022-01-05T15:00:00.000Z",
				"raceId": 1949402913700016,
				"raceName": "FC Cartagena vs Valencia",
				"sportName": "Soccer"
			  }
			},
			"bet-placed-time": "08:14:16  05-01-2022"
		  },
		  {
			"status": "matched",
			"sport-id": 15,
			"sport-name": "Soccer",
			"event-id": 1949433747610016,
			"event-name": "Besiktas JK vs Antalyaspor",
			"runner-name": "Besiktas JK",
			"decimal-odds": 1.8,
			"stake": 0.2,
			"event-full-details": {
			  "id": 1949433747610016,
			  "start": "2022-01-05T17:45:00.000Z",
			  "allRunners": {
				"Besiktas JK": {
				  "runnerId": 1949433748770016,
				  "back": 1.75,
				  "lay": 2.14,
				  "name": "Besiktas JK",
				  "numberOfRunners": 3,
				  "winPercentage": 91.42857142857143,
				  "startTime": "2022-01-05T17:45:00.000Z",
				  "raceId": 1949433747610016,
				  "raceName": "Besiktas JK vs Antalyaspor",
				  "sportName": "Soccer"
				},
				"Antalyaspor": {
				  "runnerId": 1949433748810016,
				  "back": 4.2,
				  "lay": 4.7,
				  "name": "Antalyaspor"
				},
				"DRAW (Bes/Ant)": {
				  "runnerId": 1949433748850016,
				  "back": 3.35,
				  "lay": 4.6,
				  "name": "DRAW (Bes/Ant)"
				}
			  },
			  "luckyWinner": {
				"runnerId": 1949433748770016,
				"back": 1.75,
				"lay": 2.14,
				"name": "Besiktas JK",
				"numberOfRunners": 3,
				"winPercentage": 91.42857142857143,
				"startTime": "2022-01-05T17:45:00.000Z",
				"raceId": 1949433747610016,
				"raceName": "Besiktas JK vs Antalyaspor",
				"sportName": "Soccer"
			  }
			},
			"bet-placed-time": "08:14:17  05-01-2022"
		  }
		],
		"Horse Racing": [
		  {
			"status": "matched",
			"sport-id": 24735152712200,
			"sport-name": "Horse Racing",
			"event-id": 1952502854800016,
			"event-name": "14:55 Ffos Las",
			"runner-name": "1 Getaweapon",
			"decimal-odds": 2.2,
			"stake": 0.2,
			"event-full-details": {
			  "id": 1952502854800016,
			  "start": "2022-01-05T14:55:00.000Z",
			  "allRunners": {
				"1 Getaweapon": {
				  "runnerId": 1952502855210016,
				  "back": 2.16,
				  "lay": 2.7,
				  "name": "1 Getaweapon",
				  "numberOfRunners": 5,
				  "winPercentage": 99.07407407407405,
				  "startTime": "2022-01-05T14:55:00.000Z",
				  "raceId": 1952502854800016,
				  "raceName": "14:55 Ffos Las",
				  "sportName": "Horse Racing"
				},
				"3 Fashion's Model": {
				  "runnerId": 1952502855270016,
				  "back": 5.5,
				  "lay": 11,
				  "name": "3 Fashion's Model"
				},
				"5 Gaia Vallis": {
				  "runnerId": 1952502855330016,
				  "back": 4.7,
				  "lay": 0,
				  "name": "5 Gaia Vallis"
				},
				"2 So Socksy": {
				  "runnerId": 1952502855240016,
				  "back": 4.3,
				  "lay": 10,
				  "name": "2 So Socksy"
				},
				"4 Get An Oscar": {
				  "runnerId": 1952502855300016,
				  "back": 9,
				  "lay": 18.5,
				  "name": "4 Get An Oscar"
				}
			  },
			  "luckyWinner": {
				"runnerId": 1952502855210016,
				"back": 2.16,
				"lay": 2.7,
				"name": "1 Getaweapon",
				"numberOfRunners": 5,
				"winPercentage": 99.07407407407405,
				"startTime": "2022-01-05T14:55:00.000Z",
				"raceId": 1952502854800016,
				"raceName": "14:55 Ffos Las",
				"sportName": "Horse Racing"
			  }
			},
			"bet-placed-time": "08:15:40  05-01-2022"
		  }
		]
	  };


	let g_eventCounter = 0;
	let g_runnersStr = '';

	printRunner = function(runnerName, odd, cssClass) {
		cssClass = cssClass || '';
		g_runnersStr += `<div class="gridColumnLayout gridColumnLayout_2">
					<!-- Runner Name -->
					<div class="commonClass colOne  ${cssClass}"> ${runnerName} </div>
					<!-- Stake -->
					<div class="commonClass colTwo  ${cssClass}"> ${odd} </div>
					</div>`;
	};

	createPredictedWinnersTable = function(predictedWinnerList) {
		g_eventCounter = 0;
		g_runnersStr = '';
		let metaData = '';

		for (let sport in predictedWinnerList) {
			if (predictedWinnerList.hasOwnProperty(sport)) {
				// Sport Name
				g_runnersStr +=  `  <br/>
									<div class="sportsName">
									<!-- Sports Name(Horse Racing) -->
									<div class ="commonClass"><b>${sport.toUpperCase()}</b></div>
									</div>`;

				for(let eventNo = 0, n = predictedWinnerList[sport].length; eventNo < n; ++eventNo) {
					// Event Name
					const eventName = predictedWinnerList[sport][eventNo]['event-name'];
					g_runnersStr += ` <br/>
								<div class="eventName">
									<!-- Event Name(3.30 Kempton) -->
									<div class ="commonClass">(${++g_eventCounter})   ${eventName}   (${sport.toUpperCase()})</div>
								</div>
								<br/>`;

					const eventFullDetails = predictedWinnerList[sport][eventNo]['event-full-details'];
					metaData = predictedWinnerList[sport][eventNo]['metaData'];
					

					printRunner(predictedWinnerList[sport][eventNo]['runner-name'], predictedWinnerList[sport][eventNo]['decimal-odds'], 'cssWinnerClass');

					for (let runner in eventFullDetails.allRunners) {
						// Players List
						if (eventFullDetails.allRunners.hasOwnProperty(runner)) {
							if(predictedWinnerList[sport][eventNo]['runner-name'] != eventFullDetails.allRunners[runner].name)
								printRunner(eventFullDetails.allRunners[runner].name, eventFullDetails.allRunners[runner].back);
						}
					}

					g_runnersStr += `<br/>`;
				}
			}
		}

		document.querySelector('#predictionList').innerHTML = g_runnersStr;
		document.querySelector('#statistics').innerHTML = `# Total Number of Predictions = ${g_eventCounter}`;
		document.querySelector('#statistics').innerHTML += `<br>MetaData = ${JSON.stringify(metaData)}`;
	};

	// createPredictedWinnersTable(g_sportsWiseBetList);




	




	//////////// SOCKET.IO /////////////////////////////////////////////////////// 

	const socket = io(); // NOTE: you MUST run by http://localhost:3000/index.html

	// [Client => Server] Send the data from client to server 
	function notifyToServer(event, data) {
		socket.emit(event, data);
	}

	notifyToServer('CLIENT_TO_SERVER_EVENT', JSON.stringify({ name:'sridhar', age: 40}));


	// [Client <= Server] Receive data from server to client
	socket.on("SERVER_TO_CLIENT_EVENT", async (data) => {
		const predictedWinnerList = JSON.parse(data);
		console.log(predictedWinnerList);
		createPredictedWinnersTable(predictedWinnerList);
	});

	/*

	///////////////////// REST API /////////////////////////////////////////////////////////////////////////////////////
	////////////// Basic HTTP VERBS //////////////////////////////
	// 1. Get    : Get the data from server
	// 2. Post   : Add some data to server
	///////////// Extended HTTP VERBS /////////////////////
	// 3. Delete : (like Get) Delete the data from the server
	// 4. Put    : (like Post) Replace the existing data object by the new data object in the server.
	// 5. Patch  : (like Post) Make a minor correction/edit inside the object (property alteration) which is in the server
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	

	// 1a. GET(?): get user details by key value pair
	const getUserByName = async (keyValue) => {
		try {
				const response = await fetch('/api/getUserByQuery?' + keyValue); // or from browser: http://localhost:3000/api/getUserByQuery?name=Sridhar
				const data = await response.json();
				// enter you logic when the fetch is successful
				console.log(data);
			} catch(error) {
				// enter your logic for when there is an error (ex. error toast)
				console.log(error);
			}
	};

	getUserByName("name=Sridhar");

	// 1b. GET(/): get user details by user id value
	const getUserByValue = async (value) => {
		try {
				const response = await fetch('/api/getUserIdValue/' + value); // or from browser: http://localhost:3000/api/getUserIdValue/5ec3c7c
				const data = await response.json();
				// enter you logic when the fetch is successful
				console.log(data);
			} catch(error) {
				// enter your logic for when there is an error (ex. error toast)
				console.log(error);
			}
	};

	getUserByValue("5ec3c7c");

	// 2. POST: Add user - login method
	async function login(username, password) {
		// To handle an error in an async function, you MUST use try/catch
		try {
			// fetch() starts a request and returns a promise.
			// Warning: fetch does NOT FAIL even for the incorrect page url request (Page NOT found error) bcos it consider's as successfully HTTP request.
			// It throws error only if there is some network failure(not able to send the request / not able to receive response from the server).
			// Issues like "page not found" in server [eg: serverErrors (500–599),clientErrors (400–499)], you can only find by 'response.ok' and 'response.status' from the successful response msg.
			const response = await fetch('/api/login', {
											method: 'POST',
											headers: { 'Content-Type': 'application/json' },
											body: JSON.stringify({
																	username,
																	password
																 })
											});
			// 'response.ok == true' ONLY if status range 200-299
			if (!response.ok) throw Error(`An error has occured: ${response.status}`);
			// if (response.status < 200 && response.status > 299) throw Error(`An error has occured: ${response.status}`);

			const result = await response.json();
			console.log(result); // msg from Server
		}
		catch(e) {
			console.log(e);
		}
	}

	login("sridhar", "1234");

	// 3. DELETE:
	async function deleteItem(id) {
		try {
			let response = await fetch(`https://url/${id}`, { method: "DELETE" });
		} catch (err) {
		}
	}

	// 3. PUT:
	async function replaceItem(obj) {
		try {
			let response = await fetch(`/api/replaceData`, {
			//let response = await fetch(`/api/replaceData/${obj.myId}`, {
											method: "PUT",
											headers: { "Content-Type": "application/json" },
											body: JSON.stringify(todo)
										});
		} catch (err) {
		}
	}

	replaceItem({myId: 3456})

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
*/

}); // window.addEventListener('load', function() {
