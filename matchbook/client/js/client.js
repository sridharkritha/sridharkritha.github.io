
window.addEventListener('load', function() {

	const g_sportsWiseBetList = 
									{
										"Horse Racing": [
											{
												"status": "matched",
												"sport-id": 24735152712200,
												"sport-name": "Horse Racing",
												"event-id": 1956830763120016,
												"event-name": "12:45 Ludlow",
												"runner-name": "5 Dr T J Eckleburg",
												"decimal-odds": 1.8,
												"stake": 0.2,
												"event-full-details": {
													"id": 1956830763120016,
													"start": "2022-01-10T12:45:00.000Z",
													"allRunners": {
														"5 Dr T J Eckleburg": {
															"runnerId": 1956830764010016,
															"back": 1.76,
															"lay": 1.95,
															"name": "5 Dr T J Eckleburg",
															"event-name": "12:45 Ludlow",
															"numberOfRunners": 10,
															"winPercentage": 150.00000000000003,
															"startTime": "2022-01-10T12:45:00.000Z",
															"raceId": 1956830763120016,
															"raceName": "12:45 Ludlow",
															"sportName": "Horse Racing"
														},
														"1 Illico Des Places": {
															"runnerId": 1956830763880016,
															"back": 4.4,
															"lay": 6.2,
															"name": "1 Illico Des Places",
															"event-name": "12:45 Ludlow"
														},
														"7 Imperial Sun": {
															"runnerId": 1956830764070016,
															"back": 6.6,
															"lay": 8.8,
															"name": "7 Imperial Sun",
															"event-name": "12:45 Ludlow"
														},
														"10 Angels Landing": {
															"runnerId": 1956830764170116,
															"back": 7,
															"lay": 14,
															"name": "10 Angels Landing",
															"event-name": "12:45 Ludlow"
														},
														"2 Appreciate": {
															"runnerId": 1956830763920016,
															"back": 21,
															"lay": 0,
															"name": "2 Appreciate",
															"event-name": "12:45 Ludlow"
														},
														"3 Bryanwood": {
															"runnerId": 1956830763950016,
															"back": 21,
															"lay": 0,
															"name": "3 Bryanwood",
															"event-name": "12:45 Ludlow"
														},
														"4 Dragon's Fire": {
															"runnerId": 1956830763980016,
															"back": 6,
															"lay": 0,
															"name": "4 Dragon's Fire",
															"event-name": "12:45 Ludlow"
														},
														"6 Fight For It": {
															"runnerId": 1956830764040016,
															"back": 16,
															"lay": 0,
															"name": "6 Fight For It",
															"event-name": "12:45 Ludlow"
														},
														"8 Kolisi": {
															"runnerId": 1956830764100116,
															"back": 14.5,
															"lay": 0,
															"name": "8 Kolisi",
															"event-name": "12:45 Ludlow"
														},
														"9 Mind Hunter": {
															"runnerId": 1956830764140116,
															"back": 26,
															"lay": 990,
															"name": "9 Mind Hunter",
															"event-name": "12:45 Ludlow"
														}
													},
													"metaData": {
														"stakeValue": 0.2,
														"todayTotalBetAmountLimit": 3,
														"remainingTotalBetAmountLimit": 0,
														"userBalance": 10.35,
														"winConfidencePercentage": 80,
														"minProfitOdd": 0.7
													},
													"luckyWinner": {
														"runnerId": 1956830764010016,
														"back": 1.76,
														"lay": 1.95,
														"name": "5 Dr T J Eckleburg",
														"event-name": "12:45 Ludlow",
														"numberOfRunners": 10,
														"winPercentage": 150.00000000000003,
														"startTime": "2022-01-10T12:45:00.000Z",
														"raceId": 1956830763120016,
														"raceName": "12:45 Ludlow",
														"sportName": "Horse Racing"
													}
												},
												"metaData": {
													"stakeValue": 0.2,
													"todayTotalBetAmountLimit": 3,
													"remainingTotalBetAmountLimit": 0,
													"userBalance": 10.35,
													"winConfidencePercentage": 80,
													"minProfitOdd": 0.7
												},
												"event-start-time": "10/01/2022, 12:45:00",
												"bet-placed-time": "07:50:54  10-01-2022"
											},
											{
												"status": "matched",
												"sport-id": 24735152712200,
												"sport-name": "Horse Racing",
												"event-id": 1956831980740016,
												"event-name": "13:30 Taunton",
												"runner-name": "6 Knickerbockerglory",
												"decimal-odds": 2.4,
												"stake": 0.2,
												"event-full-details": {
													"id": 1956831980740016,
													"start": "2022-01-10T13:30:00.000Z",
													"allRunners": {
														"6 Knickerbockerglory": {
															"runnerId": 1956831981840116,
															"back": 2.36,
															"lay": 2.6,
															"name": "6 Knickerbockerglory",
															"event-name": "13:30 Taunton",
															"numberOfRunners": 14,
															"winPercentage": 82.20338983050848,
															"startTime": "2022-01-10T13:30:00.000Z",
															"raceId": 1956831980740016,
															"raceName": "13:30 Taunton",
															"sportName": "Horse Racing"
														},
														"12 Sword Beach": {
															"runnerId": 1956831982010016,
															"back": 6.6,
															"lay": 34,
															"name": "12 Sword Beach",
															"event-name": "13:30 Taunton"
														},
														"1 Ben Lilly": {
															"runnerId": 1956831981700016,
															"back": 11,
															"lay": 0,
															"name": "1 Ben Lilly",
															"event-name": "13:30 Taunton"
														},
														"2 Charming Getaway": {
															"runnerId": 1956831981730116,
															"back": 10.5,
															"lay": 0,
															"name": "2 Charming Getaway",
															"event-name": "13:30 Taunton"
														},
														"4 Hartnoll Hero": {
															"runnerId": 1956831981790016,
															"back": 16,
															"lay": 0,
															"name": "4 Hartnoll Hero",
															"event-name": "13:30 Taunton"
														},
														"5 Jump Over The Moon": {
															"runnerId": 1956831981810116,
															"back": 10,
															"lay": 0,
															"name": "5 Jump Over The Moon",
															"event-name": "13:30 Taunton"
														},
														"7 Marettimo": {
															"runnerId": 1956831981870116,
															"back": 19.5,
															"lay": 0,
															"name": "7 Marettimo",
															"event-name": "13:30 Taunton"
														},
														"8 Moveit Like Minnie": {
															"runnerId": 1956831981900016,
															"back": 5.1,
															"lay": 17,
															"name": "8 Moveit Like Minnie",
															"event-name": "13:30 Taunton"
														},
														"9 Muy Bien": {
															"runnerId": 1956831981920116,
															"back": 15,
															"lay": 0,
															"name": "9 Muy Bien",
															"event-name": "13:30 Taunton"
														},
														"10 Quickbuck": {
															"runnerId": 1956831981950016,
															"back": 4.3,
															"lay": 0,
															"name": "10 Quickbuck",
															"event-name": "13:30 Taunton"
														},
														"11 Rocambolas": {
															"runnerId": 1956831981980016,
															"back": 10,
															"lay": 0,
															"name": "11 Rocambolas",
															"event-name": "13:30 Taunton"
														},
														"13 Chillabella": {
															"runnerId": 1956831982030116,
															"back": 6,
															"lay": 990,
															"name": "13 Chillabella",
															"event-name": "13:30 Taunton"
														},
														"14 Chadlington Lad": {
															"runnerId": 1956831982070016,
															"back": 19,
															"lay": 0,
															"name": "14 Chadlington Lad",
															"event-name": "13:30 Taunton"
														},
														"3 Forward Plan": {
															"runnerId": 1956831981760116,
															"back": 0,
															"lay": 0,
															"name": "3 Forward Plan",
															"event-name": "13:30 Taunton"
														}
													},
													"metaData": {
														"stakeValue": 0.2,
														"todayTotalBetAmountLimit": 3,
														"remainingTotalBetAmountLimit": 0,
														"userBalance": 10.35,
														"winConfidencePercentage": 80,
														"minProfitOdd": 0.7
													},
													"luckyWinner": {
														"runnerId": 1956831981840116,
														"back": 2.36,
														"lay": 2.6,
														"name": "6 Knickerbockerglory",
														"event-name": "13:30 Taunton",
														"numberOfRunners": 14,
														"winPercentage": 82.20338983050848,
														"startTime": "2022-01-10T13:30:00.000Z",
														"raceId": 1956831980740016,
														"raceName": "13:30 Taunton",
														"sportName": "Horse Racing"
													}
												},
												"metaData": {
													"stakeValue": 0.2,
													"todayTotalBetAmountLimit": 3,
													"remainingTotalBetAmountLimit": 0,
													"userBalance": 10.35,
													"winConfidencePercentage": 80,
													"minProfitOdd": 0.7
												},
												"event-start-time": "10/01/2022, 13:30:00",
												"bet-placed-time": "07:52:44  10-01-2022"
											}
										],
										"Soccer": [
											{
												"status": "matched",
												"sport-id": 15,
												"sport-name": "Soccer",
												"event-id": 1955588068000016,
												"event-name": "Jong FC Utrecht vs Jong Ajax",
												"runner-name": "Jong Ajax",
												"decimal-odds": 1.8,
												"stake": 0.2,
												"event-full-details": {
													"id": 1955588068000016,
													"start": "2022-01-10T17:45:00.000Z",
													"allRunners": {
														"Jong FC Utrecht": {
															"runnerId": 1955588069240016,
															"back": 4.6,
															"lay": 4.9,
															"name": "Jong FC Utrecht",
															"event-name": "Jong FC Utrecht vs Jong Ajax"
														},
														"Jong Ajax": {
															"runnerId": 1955588069280016,
															"back": 1.72,
															"lay": 1.78,
															"name": "Jong Ajax",
															"event-name": "Jong FC Utrecht vs Jong Ajax",
															"numberOfRunners": 3,
															"winPercentage": 155.81395348837214,
															"startTime": "2022-01-10T17:45:00.000Z",
															"raceId": 1955588068000016,
															"raceName": "Jong FC Utrecht vs Jong Ajax",
															"sportName": "Soccer"
														},
														"DRAW (Jon/Jon)": {
															"runnerId": 1955588069310016,
															"back": 4.4,
															"lay": 4.7,
															"name": "DRAW (Jon/Jon)",
															"event-name": "Jong FC Utrecht vs Jong Ajax"
														}
													},
													"metaData": {
														"stakeValue": 0.2,
														"todayTotalBetAmountLimit": 3,
														"remainingTotalBetAmountLimit": 0,
														"userBalance": 10.35,
														"winConfidencePercentage": 80,
														"minProfitOdd": 0.7
													},
													"luckyWinner": {
														"runnerId": 1955588069280016,
														"back": 1.72,
														"lay": 1.78,
														"name": "Jong Ajax",
														"event-name": "Jong FC Utrecht vs Jong Ajax",
														"numberOfRunners": 3,
														"winPercentage": 155.81395348837214,
														"startTime": "2022-01-10T17:45:00.000Z",
														"raceId": 1955588068000016,
														"raceName": "Jong FC Utrecht vs Jong Ajax",
														"sportName": "Soccer"
													}
												},
												"metaData": {
													"stakeValue": 0.2,
													"todayTotalBetAmountLimit": 3,
													"remainingTotalBetAmountLimit": 0,
													"userBalance": 10.35,
													"winConfidencePercentage": 80,
													"minProfitOdd": 0.7
												},
												"event-start-time": "10/01/2022, 17:45:00",
												"bet-placed-time": "07:50:59  10-01-2022"
											}
										]
									};


	let g_runnersStr = '';

	printRunner = function(runnerName, odd, cssClass) {
		cssClass = cssClass || '';
		g_runnersStr += `<div class="gridColumnLayout gridColumnLayout_2">
					<!-- Runner Name -->
					<div class="commonClass colOne  ${cssClass}"> ${runnerName} </div>
					<!-- Stake -->
					<div class="commonClass colTwo  ${cssClass}"> ${odd} </div>
					</div>`;
	};

	createPredictedWinnersTable = function(predictedWinnerList) {
		let eventCounter = 0;
		g_runnersStr = '';
		let metaData = '';

		for (let sport in predictedWinnerList) {
			if (predictedWinnerList.hasOwnProperty(sport)) {
				// Sport Name
				g_runnersStr +=  `  <br/>
									<div class="sportsName">
									<!-- Sports Name(Horse Racing) -->
									<div class ="commonClass"><b>${sport.toUpperCase()}</b></div>
									</div>`;

				for(let eventNo = 0, n = predictedWinnerList[sport].length; eventNo < n; ++eventNo) {
					// Event Name
					const eventName = predictedWinnerList[sport][eventNo]['event-name'];
					const eventFullDetails = predictedWinnerList[sport][eventNo]['event-full-details'];
					metaData = predictedWinnerList[sport][eventNo]['metaData'];

					g_runnersStr += ` <br/>
								<div class="eventName">
									<!-- Event Name(3.30 Kempton) -->
									<div class ="commonClass">(${++eventCounter})   ${eventName}   (${sport.toUpperCase()})     ${predictedWinnerList[sport][eventNo]['event-start-time']} </div>
								
									Today's Bet Amount Limit =  £ ${metaData.remainingTotalBetAmountLimit} / £ ${metaData.todayTotalBetAmountLimit}, 
									UserBalance = £ ${metaData.userBalance}, 
									WinConfidencePercentage = ${metaData.winConfidencePercentage}%, 
									MinProfitOdd = £ ${metaData.minProfitOdd}, 
									Stake = £ ${metaData.stakeValue}
								</div>
								<br/>`;

					printRunner(predictedWinnerList[sport][eventNo]['runner-name'], predictedWinnerList[sport][eventNo]['decimal-odds'], 'cssWinnerClass');

					for (let runner in eventFullDetails.allRunners) {
						// Players List
						if (eventFullDetails.allRunners.hasOwnProperty(runner)) {
							if(predictedWinnerList[sport][eventNo]['runner-name'] != eventFullDetails.allRunners[runner].name)
								printRunner(eventFullDetails.allRunners[runner].name, eventFullDetails.allRunners[runner].back);
						}
					}

					g_runnersStr += `<br/>`;
				}
			}
		}

		document.querySelector('#statistics').innerHTML = `# Total Number of Predictions = ${eventCounter}`;
		document.querySelector('#predictionList').innerHTML = g_runnersStr;
	};

	createPredictedWinnersTable(g_sportsWiseBetList); // test

	/////////////////////////// Button Events //////////////////////////////////
	let g_pageName = 'predictionsList';
	const g_pageNameDisplayArea = document.querySelector('#pageNameDisplayAreaId');
	g_pageNameDisplayArea.innerHTML = `<b>:: Predictions List ::</b>`;

	const g_predictionBtn = document.querySelector('#predictionBtnId');
	const g_placedBetBtn = document.querySelector('#placedBetBtnId');
	g_predictionBtn.addEventListener('click', showResults);
	g_placedBetBtn.addEventListener('click', showResults);

	function showResults(e) {
		switch(this.dataset.key)  // e.currentTarget.dataset.key
		{
			case 'predictionsList':
				g_pageName = this.dataset.key;
				g_pageNameDisplayArea.innerHTML = `<b>:: Predictions List ::</b>`;
				break;
			case 'placedBets':
				g_pageName = this.dataset.key;
				g_pageNameDisplayArea.innerHTML = `<b>:: Bet Placed List ::</b>`;
				break;
		}
		// console.log(e.key);       // d
		// console.log(this.value);  // srid
	}
	////////////////////////////////////////////////////////////////////////////




	




	//////////// SOCKET.IO /////////////////////////////////////////////////////// 

	const socket = io(); // NOTE: you MUST run by http://localhost:3000/index.html

	// [Client => Server] Send the data from client to server 
	function notifyToServer(event, data) {
		socket.emit(event, data);
	}

	notifyToServer('CLIENT_TO_SERVER_EVENT', JSON.stringify({ name:'sridhar', age: 40}));


	// [Client <= Server] Receive data from server to client
	socket.on("SERVER_TO_CLIENT_EVENT", async (data) => {
		const predictedWinnerList = JSON.parse(data);
		console.log(predictedWinnerList);
		createPredictedWinnersTable(predictedWinnerList);
	});

	/*

	///////////////////// REST API /////////////////////////////////////////////////////////////////////////////////////
	////////////// Basic HTTP VERBS //////////////////////////////
	// 1. Get    : Get the data from server
	// 2. Post   : Add some data to server
	///////////// Extended HTTP VERBS /////////////////////
	// 3. Delete : (like Get) Delete the data from the server
	// 4. Put    : (like Post) Replace the existing data object by the new data object in the server.
	// 5. Patch  : (like Post) Make a minor correction/edit inside the object (property alteration) which is in the server
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	

	// 1a. GET(?): get user details by key value pair
	const getUserByName = async (keyValue) => {
		try {
				const response = await fetch('/api/getUserByQuery?' + keyValue); // or from browser: http://localhost:3000/api/getUserByQuery?name=Sridhar
				const data = await response.json();
				// enter you logic when the fetch is successful
				console.log(data);
			} catch(error) {
				// enter your logic for when there is an error (ex. error toast)
				console.log(error);
			}
	};

	getUserByName("name=Sridhar");

	// 1b. GET(/): get user details by user id value
	const getUserByValue = async (value) => {
		try {
				const response = await fetch('/api/getUserIdValue/' + value); // or from browser: http://localhost:3000/api/getUserIdValue/5ec3c7c
				const data = await response.json();
				// enter you logic when the fetch is successful
				console.log(data);
			} catch(error) {
				// enter your logic for when there is an error (ex. error toast)
				console.log(error);
			}
	};

	getUserByValue("5ec3c7c");

	// 2. POST: Add user - login method
	async function login(username, password) {
		// To handle an error in an async function, you MUST use try/catch
		try {
			// fetch() starts a request and returns a promise.
			// Warning: fetch does NOT FAIL even for the incorrect page url request (Page NOT found error) bcos it consider's as successfully HTTP request.
			// It throws error only if there is some network failure(not able to send the request / not able to receive response from the server).
			// Issues like "page not found" in server [eg: serverErrors (500–599),clientErrors (400–499)], you can only find by 'response.ok' and 'response.status' from the successful response msg.
			const response = await fetch('/api/login', {
											method: 'POST',
											headers: { 'Content-Type': 'application/json' },
											body: JSON.stringify({
																	username,
																	password
																 })
											});
			// 'response.ok == true' ONLY if status range 200-299
			if (!response.ok) throw Error(`An error has occured: ${response.status}`);
			// if (response.status < 200 && response.status > 299) throw Error(`An error has occured: ${response.status}`);

			const result = await response.json();
			console.log(result); // msg from Server
		}
		catch(e) {
			console.log(e);
		}
	}

	login("sridhar", "1234");

	// 3. DELETE:
	async function deleteItem(id) {
		try {
			let response = await fetch(`https://url/${id}`, { method: "DELETE" });
		} catch (err) {
		}
	}

	// 3. PUT:
	async function replaceItem(obj) {
		try {
			let response = await fetch(`/api/replaceData`, {
			//let response = await fetch(`/api/replaceData/${obj.myId}`, {
											method: "PUT",
											headers: { "Content-Type": "application/json" },
											body: JSON.stringify(todo)
										});
		} catch (err) {
		}
	}

	replaceItem({myId: 3456})

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
*/

}); // window.addEventListener('load', function() {
