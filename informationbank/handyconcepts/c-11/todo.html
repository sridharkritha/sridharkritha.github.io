<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="../../../../../schema.org/WebPage.html">

<!-- Mirrored from sites.google.com/site/sridharkritha/handyconcepts/c-11/todo by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Jul 2021 10:31:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { /*

Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/
(function(){function e(g){this.t={};this.tick=function(h,k,f){this.t[h]=[void 0!=f?f:(new Date).getTime(),k];if(void 0==f)try{window.console.timeStamp("CSI/"+h)}catch(m){}};this.getStartTickTime=function(){return this.t.start[0]};this.tick("start",null,g)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var l=0<d?new e(d):new e;window.jstiming={Timer:e,load:l};if(a){var b=a.navigationStart;0<b&&d>=b&&(window.jstiming.srt=d-b)}if(a){var c=window.jstiming.load;0<b&&d>=
b&&(c.tick("_wtsrt",void 0,b),c.tick("wtsrt_","_wtsrt",d),c.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),c&&0<b&&(c.tick("_tbnd",void 0,window.chrome.csi().startE),c.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,c&&0<b&&(c.tick("_tbnd",void 0,window.external.startE),c.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(g){}})(); })()
</script>
<link rel="shortcut icon" type="image/x-icon" href="../../../../../www.google.com/images/icons/product/sites-16.ico" />
<link rel="apple-touch-icon" href="../../../../../ssl.gstatic.com/sites/p/a71eef/system/app/images/apple-touch-icon.png" type="image/png" />
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { function d(a){return document.getElementById(a)}window.byId=d;function g(a){return a.replace(/^\s+|\s+$/g,"")}window.trim=g;var h=[],k=0;window.JOT_addListener=function(a,b,c){var f=new String(k++);a={eventName:a,handler:b,compId:c,key:f};h.push(a);return f};window.JOT_removeListenerByKey=function(a){for(var b=0;b<h.length;b++)if(h[b].key==a){h.splice(b,1);break}};window.JOT_removeAllListenersForName=function(a){for(var b=0;b<h.length;b++)h[b].eventName==a&&h.splice(b,1)};
window.JOT_postEvent=function(a,b,c){var f={eventName:a,eventSrc:b||{},payload:c||{}};if(window.JOT_fullyLoaded)for(b=h.length,c=0;c<b&&c<h.length;c++){var e=h[c];e&&e.eventName==a&&(f.listenerCompId=e.compId||"",(e="function"==typeof e.handler?e.handler:window[e.handler])&&e(f))}else window.JOT_delayedEvents.push({eventName:a,eventSrc:b,payload:c})};window.JOT_delayedEvents=[];window.JOT_fullyLoaded=!1;
window.JOT_formatRelativeToNow=function(a,b){a=((new Date).getTime()-a)/6E4;if(1440<=a||0>a)return null;var c=0;60<=a&&(a/=60,c=2);2<=a&&c++;return b?window.JOT_siteRelTimeStrs[c].replace("__duration__",Math.floor(a)):window.JOT_userRelTimeStrs[c].replace("__duration__",Math.floor(a))}; })()
</script>
<script>

  

  var breadcrumbs = [{"path":"/site/sridharkritha/handyconcepts","deleted":false,"title":"handyconcepts","dir":"ltr"},{"path":"/site/sridharkritha/handyconcepts/c-11","deleted":false,"title":"C++ 11","dir":"ltr"},{"path":"/site/sridharkritha/handyconcepts/c-11/todo","deleted":false,"title":"todo","dir":"ltr"}];
  var JOT_clearDotPath = '../../../../../ssl.gstatic.com/sites/p/a71eef/system/app/images/cleardot.gif';

  
  var JOT_userRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

  
  

  

  var webspace = {"gvizGstaticVersion":"current","enableAnalytics":false,"pageSharingId":"jotspot_page","codeembeds":{"outerIframeSrc":"https://www.gstatic.com/jotspot/embeds/code/0f08d42392f2000e7e3f3daf5b427a43/outer_iframe.html","innerIframeSrc":"https://1313331507-jotspot-embeds.googleusercontent.com/code/8d87fa64604b2a11fae2ed06104c58d3/inner_iframe.html"},"enableUniversalAnalytics":false,"sharingPolicy":"OPENED","siteTitle":"sridharkritha","experiments":{"enableSubpagesGadgetInTakeout":true,"DisableSiteEditingFeature__disable_site_editing":true,"disableDomainEditing":false},"jot2atari":{"eligibility":"INELIGIBLE"},"onepickUrl":"https://docs.google.com/picker","adsensePublisherId":null,"features":{"moreMobileStyleImprovements":null,"subscriptionDataMigrationInProgress":null,"plusBadge":false},"configProperties":{"disableSiteEditing":null},"isPublic":true,"newSitesBaseUrl":"https://sites.google.com","isConsumer":true,"serverFlags":{"jot2AtariLearnMoreUrl":"https://support.google.com/sites/answer/7035197"},"domainAnalyticsAccountId":"","plusPageId":"","signInUrl":"https://accounts.google.com/AccountChooser?continue\u003dhttps://sites.google.com/site/sridharkritha/handyconcepts/c-11/todo\u0026service\u003djotspot","analyticsAccountId":"","scottyUrl":"/_/upload","homePath":"/","siteNoticeUrlEnabled":null,"plusPageUrl":"","adsensePromoClickedOrSiteIneligible":true,"csiReportUri":"https://gg.google.com/csi","sharingId":"jotspot","termsUrl":"//www.google.com/intl/en/policies/terms/","gvizVersion":1,"editorResources":{"sitelayout":["https://ssl.gstatic.com/sites/p/a71eef/system/app/css/sitelayouteditor.css"],"text":["https://ssl.gstatic.com/sites/p/a71eef/system/js/codemirror.js","../../../../../ssl.gstatic.com/sites/p/a71eef/system/app/css/codemirror_css.css","../../../../../ssl.gstatic.com/sites/p/a71eef/system/js/trog_edit__en.js","../../../../../ssl.gstatic.com/sites/p/a71eef/system/app/css/trogedit.css","../../_/rsrc/1624520311000/system/app/css/editor.css","../../../../../ssl.gstatic.com/sites/p/a71eef/system/app/css/codeeditor.css","/site/sridharkritha/_/rsrc/1624520311000/system/app/css/camelot/editor-jfk.css"]},"sharingUrlPrefix":"/_/sharing","isAdsenseEnabled":true,"domain":"defaultdomain","baseUri":"/site/sridharkritha","name":"sridharkritha","siteTemplateId":false,"siteNoticeRevision":null,"siteNoticeUrlAddress":null,"siteNoticeMessage":null,"page":{"isRtlLocale":false,"canDeleteWebspace":null,"isPageDraft":null,"parentPath":"/handyconcepts/c-11","parentWuid":"wuid:gx:62048820bd9fddf3","siteLocale":"en","timeZone":"America/Los_Angeles","type":"text","title":"todo","locale":"en","wuid":"wuid:gx:5956ab8e2254792f","revision":7,"path":"/handyconcepts/c-11/todo","isSiteRtlLocale":false,"pageInheritsPermissions":null,"name":"todo","canChangePath":true,"state":"","properties":{},"bidiEnabled":false,"currentTemplate":{"path":"/system/app/pagetemplates/text","title":"Web Page"}},"canPublishScriptToAnyone":true,"user":{"keyboardShortcuts":true,"sessionIndex":"","guest_":true,"displayNameOrEmail":"guest","userName":"guest","uid":"","renderMobile":false,"domain":"","namespace":"","hasWriteAccess":false,"namespaceUser":false,"primaryEmail":"guest","hasAdminAccess":false},"gadgets":{"baseUri":"/site/sridharkritha/system/app/pages/gadgets"}};
  webspace.page.breadcrumbs = breadcrumbs;

  
  var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="todo - sridharkritha" />
<meta itemprop="name" content="todo - sridharkritha" />
<meta property="og:title" content="todo - sridharkritha" />
<meta name="description" content="Information Bank - Computer Science" />
<meta itemprop="description" content="Information Bank - Computer Science" />
<meta id="meta-tag-description" property="og:description" content="Information Bank - Computer Science" />
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="../../../../../ssl.gstatic.com/sites/p/a71eef/system/app/themes/ember/standard-css-ember-ltr-ltr.css" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1624520311000/system/app/css/overlaydd2a.css?cb=ember150goog-ws-noside" />
<link rel="stylesheet" type="text/css" href="../../_/rsrc/1624520311000/system/app/css/camelot/allthemes-view.css" />
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/site/sridharkritha/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>todo - sridharkritha</title>
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="">
<tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><h2></h2></div></td><td class="sites-layout-searchbox  "></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
</td>
</tr>
</table>
</div>
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left" style="display: none; width: 150px">
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<A href="../../handyconcepts.html" dir="ltr">handyconcepts</A>‎ &gt; ‎<A href="../c-11.html" dir="ltr">C++ 11</A>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr" tabindex="-1" style="outline: none">todo</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-layout-name-left-sidebar-hf sites-layout-vbox"><div class="sites-layout-tile sites-tile-name-header sites-layout-empty-tile"><div dir="ltr"><br /></div></div><table cellspacing="0" class="sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1 sites-canvas-sidebar sites-layout-empty-tile"><div dir="ltr"><br /></div></td><td class="sites-layout-tile sites-tile-name-content-2"><div dir="ltr"><div><br /></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><span style="font-size:13.3333px"><br /></span></div><div><br /></div><div><div style="color:rgb(212,212,212);background-color:rgb(30,30,30);font-family:Consolas,Courier New,monospace;font-size:16px;line-height:22px;white-space:pre"><br /><div>C++ Core Guidelines: The <span style="color:#569cd6">noexcept</span> Specifier and Operator</div><div>https:<span style="color:#6a9955">//www.modernescpp.com/index.php/c-core-guidelines-the-noexcept-specifier-and-operator</span></div><br /></div></div><div><br /></div><div><span style="font-size:13.3333px">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div><div><br /></div><div><div>Advanced Modern C++ Training - by Dr. Peter Gottschling</div><div>Ref: http://www.simunova.com/en/trainingDetails/advanced/advancedDetails/</div><div><br /></div><div><span style="white-space:pre"> </span>TOPICS</div><div>New techniques</div><div><span style="white-space:pre"> </span>Range-based for-loops (C++11)</div><div><span style="white-space:pre"> </span>RValues and move semantics (C++11)</div><div><span style="white-space:pre"> </span>Initializer lists (C++11)</div><div><span style="white-space:pre"> </span>{} vs. ()? (C++11)</div><div><span style="background-color:transparent;font-size:10pt">Templates (generic programming)</span></div><div><span style="white-space:pre"> </span>Function templates</div><div><span style="white-space:pre"> </span>Class templates</div><div><span style="white-space:pre"> </span>Variadic Templates (C++11)</div><div><span style="background-color:transparent;font-size:10pt;white-space:pre"> </span><span style="background-color:transparent;font-size:10pt">Specialization</span></div><div><span style="white-space:pre"> </span>Template arguments that are not types</div><div><span style="white-space:pre"> </span>Functors</div><div><span style="white-space:pre"> </span>Safe downcast without overhead</div><div>Type deduction in detail</div><div><span style="white-space:pre"> </span>Template arguments</div><div><span style="white-space:pre"> </span>auto (C++11)</div><div><span style="background-color:transparent;font-size:10pt;white-space:pre"> </span><span style="background-color:transparent;font-size:10pt">decltype (C++11)</span></div><div><span style="white-space:pre"> </span>decltype(auto) (C++14)</div><div><span style="white-space:pre"> </span>Deduced return type (C++14)</div><div><span style="background-color:transparent;font-size:10pt">Lambda (C++11)</span></div><div><span style="white-space:pre"> </span>Foundations</div><div><span style="white-space:pre"> </span>Generic lambdas (C++14)</div><div><span style="white-space:pre"> </span>Extended capture (C++14)</div><div>Standard Template Library</div><div><span style="white-space:pre"> </span>Iterator concept</div><div><span style="white-space:pre"> </span>Containers (partially C++11)</div><div><span style="white-space:pre"> </span>Functions (partially C++11)</div><div><span style="background-color:transparent;font-size:10pt">Meta-programming</span></div><div><span style="white-space:pre"> </span>Let the compiler compute</div><div><span style="white-space:pre"> </span>Providing type informations</div><div><span style="white-space:pre"> </span>Expression templates</div><div><span style="background-color:transparent;font-size:10pt">///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div></div>Ref:  Vector push_back vs emplace_back vs move semantics<div><a href="http://ptspts.blogspot.com/2017/02/fast-vector-append.html" rel="nofollow">http://ptspts.blogspot.com/2017/02/fast-vector-append.html</a></div><div><br /></div><div><h3 style="font-weight:normal;font-size:18.2px;color:rgb(97,46,0);margin:10pt 0px;padding:0px;font-family:Arial,Helvetica,sans-serif;background-color:rgb(255,243,219)"><a name="TOC-How-to-avoid-unnecessary-copies-when-appending-to-a-C-vector"></a>How to avoid unnecessary copies when appending to a C++ vector</h3><div style="color:rgb(41,48,59);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,243,219)"><div></div></div><div style="color:rgb(41,48,59);font-family:Arial,Helvetica,sans-serif;font-size:13px;background-color:rgb(255,243,219)"><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">If you are using C++11, and your element classes have an efficient <a href="http://en.cppreference.com/w/cpp/language/move_constructor" style="color:rgb(149,104,57)" rel="nofollow">move constructor</a> defined, then just use <a href="http://en.cppreference.com/w/cpp/container/vector/push_back" style="color:rgb(149,104,57)" rel="nofollow">push_back</a> to append, it won't do any unnecessary copies. In addition to that, if you are constructing the to-be-appended element, you can use <a href="http://en.cppreference.com/w/cpp/container/vector/emplace_back" style="color:rgb(149,104,57)" rel="nofollow">emplace_back</a> to append, which even avoids the (otherwise fast) call to the move constructor.</p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">Copying is slow and needs a lot of (temporary memory) if the object contains lots of data. Such an object is a long <i>std::string</i>: the entire array of characters get copied to a new array. This hurts performance if the copy is unnecessary, e.g. if only a temporary copy is made. For example:</p><pre style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:10.4px;color:rgb(102,102,102)"><span>std</span><span>::</span><span>string</span> <span>create_long_string</span><span>(</span><span style="color:rgb(0,0,128);font-weight:bold">int</span><span>);</span>

<span>std</span><span>::</span><span>vector</span><span>&lt;</span><span>std</span><span>::</span><span>string</span><span>&gt;</span> <span>v</span><span>;</span>
<span>{</span>
  <span style="color:rgb(0,136,0);font-style:italic">// Case A.</span>
  <span>std</span><span>::</span><span>string</span> <span>s1</span> <span>=</span> <span>create_long_string</span><span>(</span><span style="color:rgb(85,85,170)">1</span><span>); </span>// Copy is avoided by RVO
  <span>std</span><span>::</span><span>string</span> <span>s2</span> <span>=</span> <span>create_long_string</span><span>(</span><span style="color:rgb(85,85,170)">2</span><span>);</span>
  <span>std</span><span>::</span><span>string</span> <span>s3</span> <span>=</span> <span>create_long_string</span><span>(</span><span style="color:rgb(85,85,170)">3</span><span>);</span>
  <span style="color:rgb(0,136,0);font-style:italic">// Case B.</span>
  <span>v</span><span>.</span><span>push_back</span><span>(</span><span>s1</span><span>);                        // Copy happens in both C++98 &amp; C++11</span>
  <span>std</span><span>::</span><span>cout</span> <span>&lt;&lt;</span> <span>s1</span><span>;</span>
<span>}</span>
<span style="color:rgb(0,136,0);font-style:italic">// Case C.                                </span>// Copy happens in C++98 but NOT in C++11
<span>v</span><span>.</span><span>push_back</span><span>(</span><span style="color:rgb(85,85,170)">"foo"</span><span>);                       // 2 Copies happen: 1. default constructor copy and 2. copy constructor copy</span>
<span style="color:rgb(0,136,0);font-style:italic">// Case D, from C++11.</span>
<span>v</span><span>.</span><span>emplace_back</span><span>(</span><span style="color:rgb(85,85,170)">"foo"</span><span>);                    // 1 copy happens:  1. default costructor copy</span>
<span style="color:rgb(0,136,0);font-style:italic">// Case E.</span>
<span>v</span><span>.</span><span>push_back</span><span>(</span><span>create_long_string</span><span>(</span><span style="color:rgb(85,85,170)">4</span><span>));       </span>// Copy happens in C++98 but NOT in C++11
<span style="color:rgb(0,136,0);font-style:italic"><br /></span></pre><pre style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:10.4px;color:rgb(102,102,102)"><span style="color:rgb(0,136,0);font-style:italic">// Case F.</span>
<span>v</span><span>.</span><span>push_back</span><span>(</span><span>std</span><span>::</span><span>string</span><span>());</span> <span>v</span><span>.</span><span>back</span><span>().</span><span>swap</span><span>(</span><span>s2</span><span>);</span>
<span style="color:rgb(0,136,0);font-style:italic">// Case G, from C++11.</span>
<span>v</span><span>.</span><span>push_back</span><span>(</span><span>std</span><span>::</span><span>move</span><span>(</span><span>s3</span><span>));               // NO extra copy involved</span></pre><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">In <b>Case A</b>, <a href="https://en.wikipedia.org/wiki/Return_value_optimization" style="color:rgb(149,104,57)" rel="nofollow">return value optimization</a> prevents unnecessary copying: the string built-in the function body of <i>create_long_string</i> is placed directly to <i>s1</i>.</p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">In <b>Case B,</b> a <b>copy</b> has to be made (there is no way around it), because <i>v</i> is still valid after <i>s1</i> is destroyed, thus it <b>cannot reuse the data in <i>s1</i>.</b></p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">In <b>Case C</b> could work without a copy, but in C++98 an unnecessary copy is made. So first <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">std::string("foo")</code> is called (which makes a copy of the data), and then the copy constructor of <i>std::string</i> is called to create a new string (with a 2nd copy of the data), which gets added to <i>v</i>.</p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">In <b>Case D</b> avoids the 2nd (unnecessary) copy, but it works only from C++11. In earlier versions of C++ (such as C++98), <i>std::vector</i> doesn't have the <i>emplace_back</i> method.</p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">In <b>Case E,</b> there is an unnecessary copy in C++98: <i>create_long_string</i> creates a <i>std::string</i>, and it gets copied to a new <i>std::string</i> within <i>v</i>. It would be better if <i>create_long_string</i> could create the <i>std::string</i> to its final location.</p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">In <b>Case F </b>shows the workaround in C++98 of adding <i>s2</i> to an <i>std::vector</i> without a copy. It's a workaround because it's a bit ugly and it still involves some copying. Fortunately this copying is fast: it copies only the empty string. As a side effect, the value of <i>s2</i> is lost, it will then be the empty string.</p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">In <b>Case G </b>shows the C++11 way of adding <i>s3</i> to an <i>std::vector</i> <b>without </b>a copy. It doesn't work in C++98 (there is no <i>std::move</i> in C++98). The <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">std::move(s3)</code> visibly documents that the old value of <i>s3</i> is lost.</p><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">C++11 (the version of C++ after C++98) introduces rvalue references, move constructors and move semantics to avoid unnecessary copies.  This will fix both <b>Case C </b>and  <b>Case E. </b>For this to work, new code needs to be added to the element class (in our case <i>std::string</i>) and to the container class (in our case <i>std::vector</i>) as well. Fortunately, the callers (including our code above and the body of <i>create_long_string</i>) can be kept unchanged. The following code has been added to the C++ standard library (STL) in C++11:</p><pre style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:10.4px;color:rgb(102,102,102)"><span style="color:rgb(0,0,128);font-weight:bold">class</span> <span>string</span> <span>{</span>
  <span>...</span>
  <span style="color:rgb(0,136,0);font-style:italic">// Copy constructor. C++98.</span>
  <span>string</span><span>(</span><span style="color:rgb(0,0,128);font-weight:bold">const</span> <span>string</span><span>&amp;</span> <span>old</span><span>)</span> <span>{</span> <span>...</span> <span>}</span>
  <span style="color:rgb(0,136,0);font-style:italic">// Move constructor. Not in C++98, added in C++11.</span>
  <span>string</span><span>(</span><span>string</span><span>&amp;&amp;</span> <span>old</span><span>)</span> <span>{</span> <span>...</span> <span>}</span> <span>...</span> <span>}</span>
<span>};</span>

<span style="color:rgb(0,0,128);font-weight:bold">template</span><span>&lt;</span><span style="color:rgb(0,0,128);font-weight:bold">typename</span> <span>T</span><span>,</span> <span>...</span><span>&gt;</span>
<span style="color:rgb(0,0,128);font-weight:bold">class</span> <span>vector</span> <span>{</span>
  <span>...</span>
  <span style="color:rgb(0,136,0);font-style:italic">// Takes a const reference. C++98.</span>
  <span style="color:rgb(0,0,128);font-weight:bold">void</span> <span>push_back</span><span>(</span><span style="color:rgb(0,0,128);font-weight:bold">const</span> <span>T</span><span>&amp;</span> <span>t</span><span>);</span>
  <span style="color:rgb(0,136,0);font-style:italic">// Takes an rvalue reference. Not in C++98, added in C++11.</span>
  <span style="color:rgb(0,0,128);font-weight:bold">void</span> <span>push_back</span><span>(</span><span>T</span><span>&amp;&amp;</span> <span>t</span><span>);</span>
<span>};</span></pre><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">As soon as both of these are added, when <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">v.push_back(...)</code> will attempt to call the 2nd method (which takes the rvalue reference), which will call to move constructor of <i>std::string</i> instead of the copy constructor. This gives us the benefit of no copying, because typically the move constructor is fast, because it doesn't copy data. In general, the move constructor creates the new object with the data of the <i>old</i> object, and it can leave the old old object in an arbitrary but valid state. For <i>std::string</i>, it just copies the <b>pointer </b>to the data (which is fast, because it doesn't copy the data itself), and sets the pointer in the old <i>std::string</i> to <i>nullptr</i>. Thus Case C and Case E become fast in C++11. <b>Case B</b> is <b>not </b>affected (it still copies), and that's good, because we want to print <i>s1</i> to <i>cout</i> below, so we want that data there. This happens automatically, because in the call <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">v.push_back(s1)</code>, <i>s1</i> is not an rvalue reference, thus the cost-reference <i>push_back</i> will be called, which does a copy. For more details about the magic to select the proper <i>push_back</i>, see <a href="http://www.cprogramming.com/c++11/rvalue-references-and-move-semantics-in-c++11.html" style="color:rgb(149,104,57)" rel="nofollow">this tutorial</a> or <a href="http://thbecker.net/articles/rvalue_references/section_01.html" style="color:rgb(149,104,57)" rel="nofollow">this tutorial</a>.</p><h3 style="font-weight:normal;font-size:18.2px;color:rgb(97,46,0);margin:10pt 0px 5pt;padding:0px"><a name="TOC-Guidelines-to-avoid-unnecessary-copies"></a>Guidelines to avoid unnecessary copies</h3><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">Define your (element) classes like this:</p><ul style="margin-left:1em;padding:0px"><li style="line-height:1.4em">Define the default constructor (<code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">C() { ... }</code>).</li><li style="line-height:1.4em">Define the destructor (<code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">~C() { ... }</code>).</li><li style="line-height:1.4em">Define the copy constructor (<code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">C(const C&amp; c) { ... }</code>).</li><li style="line-height:1.4em">It's a good practice to define operator=, but not needed here.</li><li style="line-height:1.4em">For C++11 classes, define a move constructor (e.g. <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">C(C&amp;&amp; c) { ... }</code>).</li><li style="line-height:1.4em">For C++11 classes, don't define a member <i>swap</i> method. If you must define it, then also define a method <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">void shrink_to_fit() { ... }</code>. It doesn't matter what the method does, you can just declare it. The <a href="https://github.com/pts/fast_vector_append" style="color:rgb(149,104,57)" rel="nofollow">fast_vector_append library</a> detects <i>shrink_to_fit</i>, and will use the move constructor instead of the <i>swap</i> method, the former being slightly faster, although neither copies the data.</li><li style="line-height:1.4em">For C++98 classes, don't define a move constructor. In fact, C++98 doesn't support move constructors.</li><li style="line-height:1.4em">For C++98 classes, define a member <i>swap</i> method.</li></ul><p style="margin:0px 0px 0.6em;padding:0px;line-height:1.4em">To append a new element to an <i>std::vector</i> without unnecessary copying, as fast as possible, follow this advice from top to bottom:</p><ul style="margin-left:1em;padding:0px"><li style="line-height:1.4em">If it's C++11 mode, and the object is being constructed (not returned by a function!), use emplace_back without the element class name.</li><li style="line-height:1.4em">If it's C++11 mode, and the class has a move constructor, use <i>push_back</i>.</li><li style="line-height:1.4em">If it's C++11 mode, and the class has the member <i>swap</i> method, use: <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">{ C c(42); v.resize(v.size() + 1); v.back().swap(c); }</code></li><li style="line-height:1.4em">If the class has the member <i>swap</i> method, use: <code style="font-family:DejaVu Sans Mono,Bitstream Vera Mono,Lucida Console,Lucida Sans Mono,Consolas,Courier New;font-size:11.7px;color:rgb(102,102,102)">{ C c(42); v.push_back(C()); v.back().swap(c); }</code></li><li style="line-height:1.4em">Use <i>push_back</i>. (This is the only case with a slow copy.)</li></ul></div><div><br /></div></div></div></td></tr></tbody></table><div class="sites-layout-tile sites-tile-name-footer sites-layout-empty-tile"><div dir="ltr"><br /></div></div></div>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
<a xmlns="http://www.w3.org/1999/xhtml" name="page-comments"></a>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-comments"><div class="sites-comment-docos-wrapper"><div class="sites-comment-docos"><div class="sites-comment-docos-background"></div><div class="sites-comment-docos-header"><div class="sites-comment-docos-header-title">Comments</div></div><div id="sites-comment-docos-pane" class="sites-comment-docos-pane"></div></div></div></div>
</div>
</div> 
</td> 
</tr>
</table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://accounts.google.com/ServiceLogin?continue=https://sites.google.com/site/sridharkritha/handyconcepts/c-11/todo&amp;service=jotspot">Sign in</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/recentChanges.html">Recent Site Activity</a><span aria-hidden="true">|</span><a class="sites-system-link" href="../../system/app/pages/reportAbuse.html" target="_blank">Report Abuse</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">Print Page</a><span aria-hidden="true">|</span><span class="sites-system-link">Powered By</span> <b class="powered-by"><a href="http://sites.google.com/site">Google Sites</a></b></p></div>
</div>
</div> 
</div> 
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../../../../ssl.gstatic.com/sites/p/a71eef/system/js/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
              new sites.CommentPane('//docs.google.com/comments/d/AAHRpnXtASf_M2E6cjJ9Hgufts3RfM7MwuhM--x9xhZTQT2CPH7h7LogFWt7l1f1Gcz8s_lxe1RQ8Qv6RcbbApGDDEiQ2hkVZ7vYkCUqICo-g4d9iv_fLc2NvhICeJm6-bBWqgxiMdIiV/api/js?anon=true',
                  false, false);
            </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([1109635200000, 1128902400000, 1130657000000, 1143333000000, 1143806400000, 1145000000000, 1146380000000, 1152489600000, 1159800000000, 1159500000000, 1162095000000, 1162075000000, 1162105500000]);
    gsites.Xhr.send('../../_/tz.html', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, '../../../../../gg.google.com/csi.gif');
                    }
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
  //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupPostRenderingManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<script type="text/javascript">
          sites.codeembed.init();
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>
</body>

<!-- Mirrored from sites.google.com/site/sridharkritha/handyconcepts/c-11/todo by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 09 Jul 2021 10:31:35 GMT -->
</html>
